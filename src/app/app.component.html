<div class="page-container">
  <div class="map-container">
    <!-- <mgl-map
      [style]="'mapbox://styles/mapbox/streets-v11'"
      [zoom]="[11]"
      [center]="center"
      [attributionControl]="false"
      (load)="loaded($event)"
      (click)="mapClick($event)"
    >
      <mgl-control mglNavigation position="top-right"></mgl-control>
      <mgl-control
        mglScale
        unit="imperial"
        position="bottom-right"
      ></mgl-control>
      <ng-container *ngFor="let location of locations">

        <mgl-layer
          [id]="location.id"
          type="symbol"></mgl-layer>
      </ng-container>

      <mgl-popup
        *ngIf="selectedLocationId"
        [lngLat]="selectedLocation.coordinates"
        [offset]="25"
        (close)="unselectLocation()"
      >
        <h3>{{ selectedLocation.organization }}</h3>
        <div>{{ selectedLocation.address1 }}</div>
      </mgl-popup>
    </mgl-map> -->

    <mgl-map
      [style]="'mapbox://styles/mapbox/bright-v9'"
      [zoom]="[11.15]"
      [center]="center"
      [cursorStyle]="cursorStyle"
    >
      <mgl-geojson-source id="points" [data]="points"></mgl-geojson-source>
      <mgl-layer
        id="points"
        source="points"
        type="symbol"
        [layout]="{
          'icon-image': 'marker-15',
          'icon-size': 2,
          'icon-allow-overlap': true
        }"
        (click)="onClick($event)"
        (mouseEnter)="cursorStyle = 'pointer'"
        (mouseLeave)="cursorStyle = ''"
      ></mgl-layer>
      <mgl-popup
        *ngIf="selectedPoint"
        [lngLat]="selectedPoint.geometry.coordinates"
        (close)="selectedPoint = null"
      >
        <span [innerHTML]="selectedPoint.properties.address1"></span>
      </mgl-popup>
    </mgl-map>
  </div>
  <div class="search-container">
    <div #searchbox class="geocoder"></div>
    <div class="results">
      <mat-card
        *ngFor="let location of points"
        (click)="cardClick(location)"
        [class.selected]="location.id == selectedLocationId"
      >
        <mat-card-header>
          <div mat-card-avatar>
            <mat-icon>star</mat-icon>
            <div>{{ location.classification }}</div>
          </div>
          <mat-card-title>{{ location.fullname }}</mat-card-title>
          <mat-card-subtitle>
            <div class="specialty mat-small">
              {{ location.specialties.join(", ") | titlecase }}
            </div>
            <div class="organization">
              {{ location.organization }} ({{
                location.distance | number: "1.1-1"
              }}
              {{ location.units }})
            </div>
            <div>
              {{ location.line1 }}
            </div>
            <div>{{ location.line2 }}</div>
          </mat-card-subtitle>
        </mat-card-header>
      </mat-card>
    </div>
  </div>
</div>
